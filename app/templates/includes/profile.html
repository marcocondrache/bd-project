{% block profile_card %}
	<!-- Modal Background -->
	<div x-show="profileOpen" class="fixed inset-0 bg-black opacity-50"></div>

	<!-- Modal Content -->
	<div x-show="profileOpen" @click.outside="profileOpen = false" x-transition
	     class="fixed inset right-0 top-16 m-2 max-w-xs bg-white shadow-xl rounded-lg p-4"
	>
		<!-- User Profile Content -->
		<div class="photo-wrapper p-2">
			<img class="w-32 h-32 rounded-full mx-auto" src="https://source.boringavatars.com/"
			     alt={{ current_user.given_name }}>
		</div>
		<div class="p-2" x-data="{
			destinationAddress: '{{ current_user.buyers[0].destination_address }}',
			oldDestinationAddress: '{{ current_user.buyers[0].destination_address }}',
			profileCardNumber: '{{ current_user.buyers[0].card_number }}',
			oldProfileCardNumber: '{{ current_user.buyers[0].card_number }}',
		}">
			<h3 class="text-center text-xl text-gray-900 font-medium leading-8">
				{{ current_user.given_name }} {{ current_user.family_name }}
			</h3>
			<!-- display the email under the name -->
			<div class="text-center text-gray-400 text-xs font-semibold">
				<p>{{ current_user.email }}</p>
			</div>
			{% if current_user.sellers %}
				<div class="text-center text-gray-400 text-xs font-semibold my-4">
					<p>Seller</p>
				</div>
			{% else %}
				<a href="/sellers/register" class="flex rounded-lg bg-indigo-500 h-10 text-white text-xs font-semibold py-1 px-2 my-4 block justify-center items-center align-center">
					Become a seller!
				</a>
			{% endif %}
			<div class="text-left text-gray-400 text-xs font-semibold">
				<p>Your Info</p>
			</div>
			<table class="text-xs my-3">
				<tbody>
				<tr>
					<td class="py-2 text-gray-500 font-semibold">Address</td>
					<td x-show="!profileEditMode" class="py-2" x-text="destinationAddress"></td>

					<td x-show="profileEditMode" class="py-2">
						<input type="text" class="border-2 border-gray-200 rounded-lg p-2 my-2" x-model="destinationAddress"
							   value="{{ current_user.buyers[0].destination_address }}">
					</td>
				</tr>
				<tr>
					<td class="py-2 pr-2 text-gray-500 font-semibold">Card Number</td>
					<td x-show="!profileEditMode" class="py-2" x-text="profileCardNumber"></td>
					<td x-show="profileEditMode" class="py-2">
						<input type="text" class="border-2 border-gray-200 rounded-lg p-2 my-2" x-model="profileCardNumber">
					</td>
				</tr>
				{% if current_user.sellers %}
					<tr>
						<td class="px-2 py-2 text-gray-500 font-semibold">IBAN</td>
						<td class="px-2 py-2">{{ current_user.sellers[0].iban }}</td>
					</tr>
				{% endif %}
				</tbody>
			</table>

			<!-- Edit Profile and Logout Buttons should be in the same row and occupation the whole row -->
			<div class="flex justify-center space-x-4">
				<button x-show="!profileEditMode" x-on:click="profileEditMode = true"
				 class="flex rounded-lg bg-indigo-500 h-10 text-white text-xs font-semibold py-1 px-2 my-2 block justify-center items-center align-center">
					Edit Profile
				</button>
				<button 
				 x-show="profileEditMode" 
				 x-on:click="saveProfile(profileCardNumber, destinationAddress)
				 	.then((res) => {
						if (res.status === 200) {
							oldDestinationAddress = destinationAddress;
							oldProfileCardNumber = profileCardNumber;
						} else {
							destinationAddress = oldDestinationAddress;
							profileCardNumber = oldProfileCardNumber;
						}
						profileEditMode = false;
					})"
				 class="flex rounded-lg bg-green-500 h-10 text-white text-xs font-semibold py-1 px-2 my-2 block justify-center items-center align-center">
					Save
				</button>
				<button x-show="!profileEditMode"
				 x-on:click="window.location.href = 'auth/logout'"
				 class="flex rounded-lg bg-red-500 h-10 text-white text-xs font-semibold py-1 px-2 my-2 block justify-center items-center align-center">
					Logout
				</button>
				<button x-show="profileEditMode" x-on:click="() => {
					destinationAddress = oldDestinationAddress;
					profileCardNumber = oldProfileCardNumber;
					profileEditMode = false;
				}"
				 class="flex rounded-lg bg-red-500 h-10 text-white text-xs font-semibold py-1 px-2 my-2 block justify-center items-center align-center">
					Cancel
				</button>
			</div>
		</div>
	</div>
{% endblock %}